<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Financial Dashboard</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      background-color: #1c1a1a;
      color: #fff;
    }

    .container {
      display: flex;
      height: 100vh;
    }

    .dashboard {
      width: 70%;
      padding: 20px;
    }

    .chatbot {
      width: 30%;
      background-color: #1e1e1e;
      padding: 20px;
      display: flex;
      flex-direction: column;
    }

    input, select, button {
      margin: 10px 0;
      padding: 10px;
      width: 26rem;
      border-radius: 5px;
      border: none;
      background-color: #333;
      color: #fff;
    }
    select{
        width: 27.2rem;
    }

    button {
      background-color: #007bff;
      cursor: pointer;
      width: 27.2rem;
      
    }

    button:hover {
      background-color: #0056b3;
    }

    .history ul {
      list-style: none;
      padding: 0;
    }

    .history li {
      margin: 10px 0;
      padding: 10px;
      border-radius: 5px;
      color: #fff;
    }

    .income { background-color:#00ff00; }
    .expense { background-color: #ff0000; }
    .savings { background-color: #0080ff; }

    .chart-container {
         margin-top: 20px;
         }
    .graphs{
        display: flex;
    }
    #chat-window {
      height: 400px;
      overflow-y: auto;
      border-radius: 5px;
      padding: 10px;
      background-color: #5d5d5d;
    }
    #pieChart{
        width: 13vw;
        margin-right: 7vw;
    }
    #barChart{
        height: 40vh;
    }
  </style>
</head>
<body>

<div class="container">
  <!-- Dashboard -->
  <div class="dashboard">
    <h1>Balance: ₹<span id="balance">0</span></h1>
    <input type="text" id="amount" placeholder="Enter amount">
    <select id="type">
      <option value="income">Income</option>
      <option value="expense">Expense</option>
      <option value="savings">Savings</option>
    </select>
    <input type="text" id="category" placeholder="Category">
    <button id="add-btn">Add Transaction</button>

    <div class="history">
      <h2>Transaction History</h2>
      <ul id="transaction-list"></ul>
    </div>
    <div class="graphs">
    <div class="chart-container">
      <h2>Spending by Category</h2>
      <canvas id="pieChart"></canvas>
    </div>
   
    <div class="chart-container">
      <h2>Monthly Financial Overview</h2>
      <canvas id="barChart"></canvas>
    </div>
    </div>
  </div>

  <!-- Chatbot -->
  <div class="chatbot">
    <h2>Financial Assistant</h2>
    <div id="chat-window"></div>
    <input type="text" id="chat-input" placeholder="Ask for advice...">
    <button id="chat-send">Send</button>
  </div>
</div>

<script>
  let balance = 0;
  const transactions = [];
  const categories = { income: {}, expense: {}, savings: {} };
  let pieChart;
  let barChart;

  document.getElementById("add-btn").addEventListener("click", function () {
    const amount = parseFloat(document.getElementById("amount").value);
    const type = document.getElementById("type").value;
    const category = document.getElementById("category").value;

    if (!amount || !category) {
      alert("Please fill all fields!");
      return;
    }

    balance += type === "expense" ? -amount : amount;
    document.getElementById("balance").innerText = balance;

    transactions.push({ amount, type, category });
    if (!categories[type][category]) categories[type][category] = 0;
    categories[type][category] += amount;

    addTransactionToHistory(amount, type, category);
    updateCharts();
  });

  function addTransactionToHistory(amount, type, category) {
    const list = document.getElementById("transaction-list");
    const listItem = document.createElement("li");
    listItem.innerText = `${type.toUpperCase()}: ₹${amount} (${category})`;
    listItem.className = type;
    list.appendChild(listItem);
  }

  function updateCharts() {
    const ctx1 = document.getElementById("pieChart").getContext("2d");
    const ctx2 = document.getElementById("barChart").getContext("2d");

    // Prepare data for pie chart
    const labels = Object.keys(categories.expense);
    const data = labels.map((cat) => categories.expense[cat] || 0);

    if (pieChart) pieChart.destroy(); 
    pieChart = new Chart(ctx1, {
      type: "pie",
      data: {
        labels: labels,
        datasets: [{
          data: data,
          backgroundColor: ["#ff6384", "#36a2eb", "#ffce56", "#4caf50", "#ff9f40"]
        }]
      }
    });

    if (barChart) barChart.destroy(); 
    barChart = new Chart(ctx2, {
      type: "bar",
      data: {
        labels: ["Previous Month", "Current Month", "Next Month"],
        datasets: [
          { label: "Income", data: [10000, 8000, 12000], backgroundColor: "#4caf50" },
          { label: "Expense", data: [8000, 6000, 9000], backgroundColor: "#f44336" },
          { label: "Savings", data: [2000, 2000, 3000], backgroundColor: "#2196f3" }
        ]
      }
    });
  }

  document.getElementById("chat-send").addEventListener("click", async function () {
    const chatInput = document.getElementById("chat-input").value;
    if (!chatInput) return;

    addChatMessage("You: " + chatInput);
    document.getElementById("chat-input").value = "";

    const response = await getAIResponse(chatInput);
    addChatMessage("AI: " + response);
  });

  function addChatMessage(message) {
    const chatWindow = document.getElementById("chat-window");
    const msgDiv = document.createElement("div");
    msgDiv.innerText = message;
    chatWindow.appendChild(msgDiv);
    chatWindow.scrollTop = chatWindow.scrollHeight;
  }

  async function getAIResponse(userMessage) {
    const apiKey = "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"; // Replace with OpenAI API Key
    const response = await fetch("https://openrouter.ai/api/v1/chat/completions", {
      method: "POST",
      headers: {
        "Authorization": `Bearer ${apiKey}`,
        "Content-Type": "application/json"
      },
      body: JSON.stringify({
        model: "gpt-3.5-turbo",
        messages: [{ role: "user", content: userMessage }],
        max_tokens: 100
      })
    });

    const data = await response.json();
    return data.choices[0].message.content;
  }
</script>

</body>
</html>